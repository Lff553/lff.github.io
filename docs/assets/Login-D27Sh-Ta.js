import{c as a,a as o,i as w,n as h,w as y,p as l,v as d,t as b,l as p,m as I,z as k,o as i}from"./vue-BrREPx09.js";import{h as c}from"./http-CXy2SX9s.js";import{_ as L}from"./index-Cb3T-4NS.js";import"./vendor-R-lXtGyY.js";const P={login:async t=>{try{return(await c.post("/auth/login",t)).data}catch(e){if(console.error("登录API调用失败:",e),e.response?.data)return e.response.data;throw e}},register:async t=>{try{return(await c.post("/auth/register",t)).data}catch(e){if(console.error("注册API调用失败:",e),e.response?.data)return e.response.data;throw e}},logout:async()=>{try{return(await c.post("/auth/logout")).data}catch(t){if(console.error("登出API调用失败:",t),t.response?.data)return t.response.data;throw t}},checkStudentId:async t=>{try{return(await c.get(`/auth/check-student-id/${t}`)).data}catch(e){throw console.error("检查学号API调用失败:",e),e}}},R={name:"Login",setup(){const t=k(),e=p(!1),u=p(!1),s=p(""),m=p(""),g=I({studentId:"",password:""}),r=I({studentId:"",name:"",password:"",confirmPassword:"",phone:"",email:""}),v=()=>{s.value="",m.value=""};return{isRegister:e,isLoading:u,errorMessage:s,successMessage:m,loginForm:g,registerForm:r,handleLogin:async()=>{if(v(),!g.studentId||!g.password){s.value="请填写完整的登录信息";return}u.value=!0;try{const n=await P.login({studentId:g.studentId,password:g.password});n.success?(m.value=n.message,localStorage.setItem("user",JSON.stringify(n.user)),localStorage.setItem("isLoggedIn","true"),setTimeout(()=>{n.user.role==="ADMIN"?t.push("/admin"):t.push("/")},1e3)):s.value=n.message}catch(n){console.error("登录失败:",n),s.value="登录失败，请检查网络连接"}finally{u.value=!1}},handleRegister:async()=>{if(v(),!r.studentId||!r.name||!r.password||!r.confirmPassword){s.value="请填写完整的注册信息";return}if(r.password!==r.confirmPassword){s.value="两次输入的密码不一致";return}if(r.password.length<6||r.password.length>20){s.value="密码长度应在6-20位之间";return}if(!/^[0-9]{8,12}$/.test(r.studentId)){s.value="学号格式不正确，应为8-12位数字";return}if(r.phone&&!/^1[3-9]\d{9}$/.test(r.phone)){s.value="手机号格式不正确";return}u.value=!0;try{const n={studentId:r.studentId,name:r.name,password:r.password,confirmPassword:r.confirmPassword};r.phone&&r.phone.trim()&&(n.phone=r.phone.trim()),r.email&&r.email.trim()&&(n.email=r.email.trim());const f=await P.register(n);f.success?(m.value=f.message+"，请登录",Object.keys(r).forEach(F=>{r[F]=""}),setTimeout(()=>{e.value=!1,m.value=""},2e3)):s.value=f.message}catch(n){console.error("注册失败:",n),s.value="注册失败，请检查网络连接"}finally{u.value=!1}}}}},S={class:"login-container"},M={class:"login-card"},V={class:"form-container"},_={class:"tab-buttons"},x={class:"form-group"},U={class:"form-group"},q=["disabled"],A={key:0},N={key:1},C={class:"form-group"},D={class:"form-group"},E={class:"form-group"},B={class:"form-group"},T={class:"form-group"},z={class:"form-group"},O=["disabled"],j={key:0},J={key:1},G={key:2,class:"error-message"},H={key:3,class:"success-message"};function K(t,e,u,s,m,g){return i(),a("div",S,[o("div",M,[e[20]||(e[20]=o("div",{class:"header"},[o("h1",{class:"title"},"杭州电子科技大学信息工程学院"),o("h2",{class:"subtitle"},"校园失物招领系统")],-1)),o("div",V,[o("div",_,[o("button",{class:h(["tab-btn",{active:!s.isRegister}]),onClick:e[0]||(e[0]=r=>s.isRegister=!1)}," 登录 ",2),o("button",{class:h(["tab-btn",{active:s.isRegister}]),onClick:e[1]||(e[1]=r=>s.isRegister=!0)}," 注册 ",2)]),s.isRegister?(i(),a("form",{key:1,onSubmit:e[11]||(e[11]=y((...r)=>s.handleRegister&&s.handleRegister(...r),["prevent"])),class:"form"},[o("div",C,[e[14]||(e[14]=o("label",{for:"registerStudentId"},"学号",-1)),l(o("input",{id:"registerStudentId","onUpdate:modelValue":e[5]||(e[5]=r=>s.registerForm.studentId=r),type:"text",placeholder:"请输入8-12位学号",required:"",pattern:"[0-9]{8,12}",class:"form-input"},null,512),[[d,s.registerForm.studentId]])]),o("div",D,[e[15]||(e[15]=o("label",{for:"registerName"},"姓名",-1)),l(o("input",{id:"registerName","onUpdate:modelValue":e[6]||(e[6]=r=>s.registerForm.name=r),type:"text",placeholder:"请输入真实姓名",required:"",class:"form-input"},null,512),[[d,s.registerForm.name]])]),o("div",E,[e[16]||(e[16]=o("label",{for:"registerPassword"},"密码",-1)),l(o("input",{id:"registerPassword","onUpdate:modelValue":e[7]||(e[7]=r=>s.registerForm.password=r),type:"password",placeholder:"请输入6-20位密码",required:"",minlength:"6",maxlength:"20",class:"form-input"},null,512),[[d,s.registerForm.password]])]),o("div",B,[e[17]||(e[17]=o("label",{for:"confirmPassword"},"确认密码",-1)),l(o("input",{id:"confirmPassword","onUpdate:modelValue":e[8]||(e[8]=r=>s.registerForm.confirmPassword=r),type:"password",placeholder:"请再次输入密码",required:"",class:"form-input"},null,512),[[d,s.registerForm.confirmPassword]])]),o("div",T,[e[18]||(e[18]=o("label",{for:"registerPhone"},"手机号",-1)),l(o("input",{id:"registerPhone","onUpdate:modelValue":e[9]||(e[9]=r=>s.registerForm.phone=r),type:"tel",placeholder:"请输入手机号（可选）",pattern:"1[3-9]\\d{9}",class:"form-input"},null,512),[[d,s.registerForm.phone]])]),o("div",z,[e[19]||(e[19]=o("label",{for:"registerEmail"},"邮箱",-1)),l(o("input",{id:"registerEmail","onUpdate:modelValue":e[10]||(e[10]=r=>s.registerForm.email=r),type:"email",placeholder:"请输入邮箱（可选）",class:"form-input"},null,512),[[d,s.registerForm.email]])]),o("button",{type:"submit",disabled:s.isLoading,class:"submit-btn"},[s.isLoading?(i(),a("span",j,"注册中...")):(i(),a("span",J,"注册"))],8,O)],32)):(i(),a("form",{key:0,onSubmit:e[4]||(e[4]=y((...r)=>s.handleLogin&&s.handleLogin(...r),["prevent"])),class:"form"},[o("div",x,[e[12]||(e[12]=o("label",{for:"loginStudentId"},"学号",-1)),l(o("input",{id:"loginStudentId","onUpdate:modelValue":e[2]||(e[2]=r=>s.loginForm.studentId=r),type:"text",placeholder:"请输入学号",required:"",class:"form-input"},null,512),[[d,s.loginForm.studentId]])]),o("div",U,[e[13]||(e[13]=o("label",{for:"loginPassword"},"密码",-1)),l(o("input",{id:"loginPassword","onUpdate:modelValue":e[3]||(e[3]=r=>s.loginForm.password=r),type:"password",placeholder:"请输入密码",required:"",class:"form-input"},null,512),[[d,s.loginForm.password]])]),o("button",{type:"submit",disabled:s.isLoading,class:"submit-btn"},[s.isLoading?(i(),a("span",A,"登录中...")):(i(),a("span",N,"登录"))],8,q)],32)),s.errorMessage?(i(),a("div",G,b(s.errorMessage),1)):w("",!0),s.successMessage?(i(),a("div",H,b(s.successMessage),1)):w("",!0)])])])}const ee=L(R,[["render",K],["__scopeId","data-v-86736672"]]);export{ee as default};
