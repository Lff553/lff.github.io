import{l as k,h as _,s as st,c as r,a as t,x as N,i as I,b as c,j as n,t as a,F as p,q as g,k as d,p as et,v as nt,y as ot,u,z as at,o as l,n as b,A as lt}from"./vue.js";import{b as it,c as rt,E as ct,f as x,t as E,a as M}from"./EditItemModal.js";import{_ as dt}from"./index.js";import"./http.js";import"./vendor.js";const ut={class:"admin-dashboard"},ht={class:"sidebar"},vt={class:"user-section"},mt={class:"user-avatar"},_t={class:"user-info"},pt={class:"user-name"},gt={class:"user-id"},bt={class:"sidebar-nav"},ft=["onClick"],Ct={class:"main-content"},yt={key:0,class:"dashboard"},kt={class:"dashboard-header"},wt={class:"stats-grid"},It={class:"stat-card"},xt={class:"stat-icon total"},Et={class:"stat-content"},Dt={class:"stat-card"},St={class:"stat-icon available"},At={class:"stat-content"},Bt={class:"stat-card"},Nt={class:"stat-icon pending"},Mt={class:"stat-content"},Lt={class:"stat-card"},Pt={class:"stat-icon completed"},Vt={class:"stat-content"},$t={class:"recent-section"},Tt={class:"recent-items"},Rt={class:"recent-item-info"},Ft={class:"recent-item-time"},Ot={class:"recent-item-status"},jt={key:1,class:"items-management"},Gt={class:"management-header"},Ht={class:"management-actions"},Kt={class:"items-table-container"},Ut={class:"items-table"},zt={class:"item-title"},Jt={class:"item-description"},qt={class:"item-actions"},Qt=["onClick"],Wt=["onClick"],Xt={key:2,class:"claims-management"},Yt={class:"management-header"},Zt={class:"filter-tabs"},ts=["onClick"],ss={class:"claims-list"},es={class:"claim-header"},ns={class:"claim-content"},os={class:"claim-info"},as={key:0,class:"claim-actions"},ls=["onClick"],is=["onClick"],rs={__name:"AdminDashboard",setup(cs){const L=()=>n("svg",{width:20,height:20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[n("rect",{x:3,y:3,width:7,height:7}),n("rect",{x:14,y:3,width:7,height:7}),n("rect",{x:14,y:14,width:7,height:7}),n("rect",{x:3,y:14,width:7,height:7})]),D=()=>n("svg",{width:20,height:20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[n("line",{x1:16.5,y1:9.4,x2:7.5,y2:4.21}),n("path",{d:"m21 16-4 2-4-2"}),n("path",{d:"m21 8-4 2-4-2"}),n("path",{d:"m5 12-4 2-4-2"}),n("path",{d:"m9 12 4 2 4-2"}),n("path",{d:"m17 12 4 2-4 2-4-2"}),n("path",{d:"m13 12-4-2-4 2"})]),P=()=>n("svg",{width:20,height:20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[n("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),n("circle",{cx:9,cy:7,r:4}),n("polyline",{points:"16,11 18,13 22,9"})]),V=()=>n("svg",{width:20,height:20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[n("circle",{cx:11,cy:11,r:8}),n("path",{d:"m21 21-4.35-4.35"})]),$=()=>n("svg",{width:20,height:20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[n("circle",{cx:12,cy:12,r:10}),n("polyline",{points:"12,6 12,12 16,14"})]),T=()=>n("svg",{width:20,height:20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[n("polyline",{points:"20,6 9,17 4,12"})]),R=()=>n("svg",{width:16,height:16,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[n("path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}),n("path",{d:"M21 3v5h-5"}),n("path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}),n("path",{d:"M8 16l-5-5 5-5"})]),F=()=>n("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[n("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),n("circle",{cx:12,cy:7,r:4})]),O=()=>n("svg",{width:20,height:20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[n("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),n("polyline",{points:"16,17 21,12 16,7"}),n("line",{x1:21,y1:12,x2:9,y2:12})]),i=it(),f=rt(),j=at(),v=k("dashboard"),w=k(""),C=k("all"),h=k(null);f.initFromStorage();const G=_(()=>f.userName),H=_(()=>f.userStudentId),K=[{id:"dashboard",name:"仪表盘",icon:L},{id:"items",name:"失物管理",icon:D},{id:"claims",name:"认领管理",icon:P}],U=[{value:"all",label:"全部"},{value:"PENDING",label:"待处理"},{value:"APPROVED",label:"已通过"},{value:"REJECTED",label:"已驳回"},{value:"COMPLETED",label:"已完成"}],y=_(()=>{const o=i.items,s=i.claims;return{totalItems:o.length,availableItems:o.filter(e=>e.status==="AVAILABLE").length,pendingClaims:s.filter(e=>e.status==="PENDING").length,completedClaims:s.filter(e=>e.status==="COMPLETED").length}}),z=_(()=>i.items.slice().sort((o,s)=>new Date(s.createdAt)-new Date(o.createdAt)).slice(0,5)),J=_(()=>C.value==="all"?i.claims:i.claims.filter(o=>o.status===C.value));st(async()=>{await S()});async function S(){try{await Promise.all([i.loadItems(),i.loadClaims()])}catch(o){console.error("刷新数据失败:",o)}}async function A(){try{await i.loadItems(w.value.trim()||void 0)}catch(o){console.error("搜索失败:",o)}}function q(o){h.value={...o}}async function Q(o){if(confirm(`确定要删除失物"${o.title}"吗？`))try{await i.removeItem(o.id),alert("删除成功")}catch(s){console.error("删除失败:",s),alert("删除失败，请重试")}}async function W(o){try{await i.editItem(h.value.id,o),h.value=null,alert("更新成功")}catch(s){console.error("更新失败:",s),alert("更新失败，请重试")}}async function X(o){if(confirm("确定要通过这个认领申请吗？"))try{await i.changeClaimStatus(o.id,"APPROVED"),alert("认领申请已通过")}catch(s){console.error("操作失败:",s),alert("操作失败，请重试")}}async function Y(o){if(confirm("确定要驳回这个认领申请吗？"))try{await i.changeClaimStatus(o.id,"REJECTED"),alert("认领申请已驳回")}catch(s){console.error("操作失败:",s),alert("操作失败，请重试")}}function Z(){confirm("确定要登出吗？")&&(f.logout(),j.push("/login"))}function B(o){return E(o).variant}function tt(o){return M(o).variant}return(o,s)=>(l(),r("div",ut,[t("aside",ht,[s[4]||(s[4]=t("div",{class:"sidebar-header"},[t("h2",null,"管理系统"),t("p",null,"杭州电子科技大学信息工程学院")],-1)),t("div",vt,[t("div",mt,[c(F)]),t("div",_t,[t("div",pt,a(G.value),1),s[2]||(s[2]=t("div",{class:"user-role"},"管理员",-1)),t("div",gt,a(H.value),1)])]),t("nav",bt,[(l(),r(p,null,g(K,e=>t("button",{key:e.id,class:b(["nav-item",{active:v.value===e.id}]),onClick:m=>v.value=e.id},[(l(),N(lt(e.icon),{class:"nav-icon"})),d(" "+a(e.name),1)],10,ft)),64)),t("button",{onClick:Z,class:"nav-item logout-item"},[c(O,{class:"nav-icon"}),s[3]||(s[3]=d(" 登出 ",-1))])])]),t("main",Ct,[v.value==="dashboard"?(l(),r("div",yt,[t("div",kt,[s[6]||(s[6]=t("h1",null,"数据概览",-1)),t("button",{onClick:S,class:"refresh-btn"},[c(R,{class:"refresh-icon"}),s[5]||(s[5]=d(" 刷新数据 ",-1))])]),t("div",wt,[t("div",It,[t("div",xt,[c(D)]),t("div",Et,[t("h3",null,a(y.value.totalItems),1),s[7]||(s[7]=t("p",null,"失物总数",-1))])]),t("div",Dt,[t("div",St,[c(V)]),t("div",At,[t("h3",null,a(y.value.availableItems),1),s[8]||(s[8]=t("p",null,"可认领失物",-1))])]),t("div",Bt,[t("div",Nt,[c($)]),t("div",Mt,[t("h3",null,a(y.value.pendingClaims),1),s[9]||(s[9]=t("p",null,"待处理认领",-1))])]),t("div",Lt,[t("div",Pt,[c(T)]),t("div",Vt,[t("h3",null,a(y.value.completedClaims),1),s[10]||(s[10]=t("p",null,"已完成认领",-1))])])]),t("div",$t,[s[11]||(s[11]=t("h2",null,"最近活动",-1)),t("div",Tt,[(l(!0),r(p,null,g(z.value,e=>(l(),r("div",{key:e.id,class:"recent-item"},[t("div",Rt,[t("h4",null,a(e.title),1),t("p",null,a(e.description),1),t("span",Ft,a(u(x)(e.createdAt)),1)]),t("div",Ot,[t("span",{class:b(["status-badge",B(e.status)])},a(u(E)(e.status).label),3)])]))),128))])])])):v.value==="items"?(l(),r("div",jt,[t("div",Gt,[s[12]||(s[12]=t("h1",null,"失物管理",-1)),t("div",Ht,[et(t("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>w.value=e),type:"text",placeholder:"搜索失物...",class:"search-input",onKeyup:ot(A,["enter"])},null,544),[[nt,w.value]]),t("button",{onClick:A,class:"search-btn"},"搜索")])]),t("div",Kt,[t("table",Ut,[s[13]||(s[13]=t("thead",null,[t("tr",null,[t("th",null,"标题"),t("th",null,"描述"),t("th",null,"发现地点"),t("th",null,"状态"),t("th",null,"发布时间"),t("th",null,"操作")])],-1)),t("tbody",null,[(l(!0),r(p,null,g(u(i).items,e=>(l(),r("tr",{key:e.id},[t("td",zt,a(e.title),1),t("td",Jt,a(e.description),1),t("td",null,a(e.location),1),t("td",null,[t("span",{class:b(["status-badge",B(e.status)])},a(u(E)(e.status).label),3)]),t("td",null,a(u(x)(e.createdAt)),1),t("td",qt,[t("button",{onClick:m=>q(e),class:"action-btn edit-btn"},"编辑",8,Qt),t("button",{onClick:m=>Q(e),class:"action-btn delete-btn"},"删除",8,Wt)])]))),128))])])])])):v.value==="claims"?(l(),r("div",Xt,[t("div",Yt,[s[14]||(s[14]=t("h1",null,"认领管理",-1)),t("div",Zt,[(l(),r(p,null,g(U,e=>t("button",{key:e.value,class:b(["filter-tab",{active:C.value===e.value}]),onClick:m=>C.value=e.value},a(e.label),11,ts)),64))])]),t("div",ss,[(l(!0),r(p,null,g(J.value,e=>(l(),r("div",{key:e.id,class:"claim-card"},[t("div",es,[t("h3",null,a(e.lostItem?.title||"失物信息缺失"),1),t("span",{class:b(["status-badge",tt(e.status)])},a(u(M)(e.status).label),3)]),t("div",ns,[t("div",os,[t("p",null,[s[15]||(s[15]=t("strong",null,"认领人：",-1)),d(a(e.claimerName),1)]),t("p",null,[s[16]||(s[16]=t("strong",null,"联系方式：",-1)),d(a(e.claimerContact),1)]),t("p",null,[s[17]||(s[17]=t("strong",null,"认领理由：",-1)),d(a(e.reason),1)]),t("p",null,[s[18]||(s[18]=t("strong",null,"申请时间：",-1)),d(a(u(x)(e.createdAt)),1)])]),e.status==="PENDING"?(l(),r("div",as,[t("button",{onClick:m=>X(e),class:"action-btn approve-btn"},"通过",8,ls),t("button",{onClick:m=>Y(e),class:"action-btn reject-btn"},"驳回",8,is)])):I("",!0)])]))),128))])])):I("",!0)]),h.value?(l(),N(ct,{key:0,item:h.value,onClose:s[1]||(s[1]=e=>h.value=null),onSubmit:W},null,8,["item"])):I("",!0)]))}},_s=dt(rs,[["__scopeId","data-v-4089a316"]]);export{_s as default};
