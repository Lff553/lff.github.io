import{B as k,l as m,h,m as B,C as F,c as T,o as A,a as s,b as R,j as x,w as V,p as S,v as N,i as O,t as $,D as G}from"./vue-BrREPx09.js";import{h as I}from"./http-Cfj5UhdQ.js";import{_ as q}from"./index-DrgLXO57.js";const J=async e=>(await I.get("/items",{params:e?{keyword:e}:void 0})).data,P=async e=>(await I.post("/items",e)).data,j=async(e,o)=>(await I.put(`/items/${e}`,o)).data,W=async e=>{await I.delete(`/items/${e}`)},z=async(e,o)=>(await I.post(`/items/${e}/claims`,o)).data,H=async()=>(await I.get("/claims")).data,X=async(e,o)=>(await I.put(`/claims/${e}/status`,o)).data,Y=async()=>(await I.get("/items/my")).data,K=async e=>{const o=new FormData;return o.append("file",e),(await I.post("/upload/image",o)).data},It=k("lost-found",()=>{const e=m([]),o=m([]),u=m([]),f=m(!1),i=m(null),y=h(()=>e.value.length),b=h(()=>u.value.filter(t=>t.status==="PENDING")),p=h(()=>!f.value&&e.value.length===0);async function v(t){f.value=!0,i.value=null;try{const a=await J(t);return e.value=a,a}catch(a){throw i.value=a.message,a}finally{f.value=!1}}async function g(){try{const t=await H();return u.value=t,t}catch(t){throw i.value=t.message,t}}async function l(){f.value=!0,i.value=null;try{const t=await Y();return o.value=t,t}catch(t){throw i.value=t.message,t}finally{f.value=!1}}async function d(t){try{const a=await P(t);return e.value=[a,...e.value],a}catch(a){throw i.value=a.message,a}}async function w(t,a){try{const r=await j(t,a);return e.value=e.value.map(c=>c.id===t?{...r}:c),r}catch(r){throw i.value=r.message,r}}async function E(t){try{await W(t),e.value=e.value.filter(a=>a.id!==t)}catch(a){throw i.value=a.message,a}}async function U(t,a){try{const r=await z(t,a);return C(r),r}catch(r){throw i.value=r.message,r}}async function L(t,a){try{const r=await X(t,{status:a});return C(r),r}catch(r){throw i.value=r.message,r}}function C(t){if(!t)return;const a=u.value.findIndex(r=>r.id===t.id);if(a>-1?u.value.splice(a,1,t):u.value=[t,...u.value],t.lostItemId){const r=e.value.findIndex(c=>c.id===t.lostItemId);if(r>-1){const c={...e.value[r]};c.claims=c.claims?[...c.claims]:[];const D=c.claims.findIndex(M=>M.id===t.id);D>-1?c.claims.splice(D,1,t):c.claims=[t,...c.claims],e.value.splice(r,1,c)}}}function n(){i.value=null}return{items:e,myItems:o,claims:u,loading:f,error:i,itemCount:y,pendingClaims:b,isEmpty:p,loadItems:v,loadMyItems:l,loadClaims:g,createItem:d,editItem:w,removeItem:E,createClaim:U,changeClaimStatus:L,resetError:n}}),bt=k("auth",()=>{const e=m(null),o=m(!1),u=h(()=>e.value?.role==="ADMIN"),f=h(()=>e.value?.role==="STUDENT"),i=h(()=>e.value?.name||""),y=h(()=>e.value?.studentId||""),b=d=>{e.value=d,o.value=!0,localStorage.setItem("user",JSON.stringify(d)),localStorage.setItem("isLoggedIn","true")},p=()=>{e.value=null,o.value=!1,localStorage.removeItem("user"),localStorage.removeItem("isLoggedIn")};return{user:e,isLoggedIn:o,isAdmin:u,isStudent:f,userName:i,userStudentId:y,login:b,logout:p,initFromStorage:()=>{const d=localStorage.getItem("user"),w=localStorage.getItem("isLoggedIn");if(d&&w==="true")try{e.value=JSON.parse(d),o.value=!0}catch(E){console.error("è§£æç”¨æˆ·æ•°æ®å¤±è´¥:",E),p()}},updateUser:d=>{e.value={...e.value,...d},localStorage.setItem("user",JSON.stringify(e.value))},hasPermission:d=>e.value?d==="ADMIN"?e.value.role==="ADMIN":d==="STUDENT"?e.value.role==="STUDENT"||e.value.role==="ADMIN":!0:!1}}),Q={AVAILABLE:{label:"å¯è®¤é¢†",variant:"neutral"},PENDING_REVIEW:{label:"å®¡æ ¸ä¸­",variant:"warning"},CLAIMED:{label:"å·²è®¤é¢†",variant:"warning"},RETURNED:{label:"å·²å½’è¿˜",variant:"success"}},Z={PENDING:{label:"å¾…å¤„ç†",variant:"warning"},APPROVED:{label:"å·²é€šè¿‡",variant:"success"},REJECTED:{label:"å·²é©³å›",variant:"danger"},COMPLETED:{label:"å·²å®Œæˆ",variant:"neutral"}};function St(e){if(!e)return"æ—¶é—´æœªçŸ¥";try{const o=typeof e=="string"?new Date(e):e;return Number.isNaN(o.getTime())?e:new Intl.DateTimeFormat("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}).format(o)}catch{return e}}function ht(e){return Q[e]||{label:"æœªçŸ¥çŠ¶æ€",variant:"warning"}}function wt(e){return Z[e]||{label:"æœªçŸ¥çŠ¶æ€",variant:"warning"}}const _={class:"modal-header"},tt={class:"form-group"},et={class:"form-group"},at={class:"form-group"},st={class:"form-group"},nt={class:"form-group"},rt={class:"form-group"},ot={class:"image-upload-area"},lt={key:1,class:"image-preview"},it=["src"],ut={key:0,class:"error-message"},ct={class:"form-group"},dt={class:"form-group"},mt={class:"form-actions"},pt=["disabled"],vt={__name:"EditItemModal",props:{item:{type:Object,required:!0}},emits:["close","submit"],setup(e,{emit:o}){const u=()=>x("svg",{width:20,height:20,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[x("line",{x1:18,y1:6,x2:6,y2:18}),x("line",{x1:6,y1:6,x2:18,y2:18})]),f=e,i=o,y=m(!1),b=m(null),p=m(""),v=m(""),g=m(null),l=B({title:"",description:"",location:"",finderName:"",finderContact:"",publishTime:"",status:"AVAILABLE",imageUrl:""});function d(n){if(!n)return"";const t=new Date(n);if(isNaN(t.getTime()))return"";const a=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),c=String(t.getDate()).padStart(2,"0"),D=String(t.getHours()).padStart(2,"0"),M=String(t.getMinutes()).padStart(2,"0");return`${a}-${r}-${c}T${D}:${M}`}function w(){b.value?.click()}function E(n){const t=n.target.files[0];if(!t)return;if(v.value="",!t.type.startsWith("image/")){v.value="è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶";return}if(t.size>10*1024*1024){v.value="å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡10MB";return}g.value=t;const a=new FileReader;a.onload=r=>{p.value=r.target.result},a.readAsDataURL(t)}function U(){p.value="",g.value=null,l.imageUrl="",v.value="",b.value&&(b.value.value="")}async function L(){if(!g.value)return null;try{return(await K(g.value)).url}catch(n){throw v.value="å›¾ç‰‡ä¸Šä¼ å¤±è´¥: "+(n.response?.data?.error||n.message),n}}F(()=>f.item,n=>{n&&(Object.assign(l,{title:n.title||"",description:n.description||"",location:n.location||"",finderName:n.finderName||"",finderContact:n.finderContact||"",publishTime:d(n.createdAt),status:n.status||"AVAILABLE",imageUrl:n.imageUrl||""}),n.imageUrl?(p.value=n.imageUrl,g.value=null):(p.value="",g.value=null))},{immediate:!0});async function C(){if(!y.value){y.value=!0,v.value="";try{if(g.value){const t=await L();l.imageUrl=t}await new Promise(t=>setTimeout(t,500));const n={...l};if(n.publishTime){const t=new Date(n.publishTime);n.createdAt=t.toISOString()}i("submit",n)}catch{}finally{y.value=!1}}}return(n,t)=>(A(),T("div",{class:"modal-overlay",onClick:t[10]||(t[10]=a=>n.$emit("close"))},[s("div",{class:"modal-content",onClick:t[9]||(t[9]=V(()=>{},["stop"]))},[s("div",_,[t[11]||(t[11]=s("h2",null,"ç¼–è¾‘å¤±ç‰©ä¿¡æ¯",-1)),s("button",{onClick:t[0]||(t[0]=a=>n.$emit("close")),class:"close-btn"},[R(u)])]),s("form",{onSubmit:V(C,["prevent"]),class:"modal-form"},[s("div",tt,[t[12]||(t[12]=s("label",{for:"title"},"å¤±ç‰©æ ‡é¢˜ *",-1)),S(s("input",{id:"title","onUpdate:modelValue":t[1]||(t[1]=a=>l.title=a),type:"text",placeholder:"è¯·è¾“å…¥å¤±ç‰©æ ‡é¢˜",required:"",class:"form-input"},null,512),[[N,l.title]])]),s("div",et,[t[13]||(t[13]=s("label",{for:"description"},"è¯¦ç»†æè¿° *",-1)),S(s("textarea",{id:"description","onUpdate:modelValue":t[2]||(t[2]=a=>l.description=a),placeholder:"è¯·è¯¦ç»†æè¿°å¤±ç‰©çš„ç‰¹å¾ã€é¢œè‰²ã€å¤§å°ç­‰ä¿¡æ¯",required:"",rows:"4",class:"form-textarea"},null,512),[[N,l.description]])]),s("div",at,[t[14]||(t[14]=s("label",{for:"location"},"å‘ç°åœ°ç‚¹ *",-1)),S(s("input",{id:"location","onUpdate:modelValue":t[3]||(t[3]=a=>l.location=a),type:"text",placeholder:"è¯·è¾“å…¥å‘ç°å¤±ç‰©çš„å…·ä½“åœ°ç‚¹",required:"",class:"form-input"},null,512),[[N,l.location]])]),s("div",st,[t[15]||(t[15]=s("label",{for:"finderName"},"å‘ç°äººå§“å *",-1)),S(s("input",{id:"finderName","onUpdate:modelValue":t[4]||(t[4]=a=>l.finderName=a),type:"text",placeholder:"è¯·è¾“å…¥å‘ç°äººå§“å",required:"",class:"form-input"},null,512),[[N,l.finderName]])]),s("div",nt,[t[16]||(t[16]=s("label",{for:"finderContact"},"è”ç³»æ–¹å¼ *",-1)),S(s("input",{id:"finderContact","onUpdate:modelValue":t[5]||(t[5]=a=>l.finderContact=a),type:"text",placeholder:"è¯·è¾“å…¥è”ç³»æ–¹å¼",required:"",class:"form-input"},null,512),[[N,l.finderContact]])]),s("div",rt,[t[18]||(t[18]=s("label",{for:"image"},"å¤±ç‰©ç…§ç‰‡",-1)),s("div",ot,[s("input",{id:"image",ref_key:"fileInput",ref:b,type:"file",accept:"image/*",onChange:E,class:"file-input"},null,544),p.value?(A(),T("div",lt,[s("img",{src:p.value,alt:"å¤±ç‰©ç…§ç‰‡é¢„è§ˆ",class:"preview-image"},null,8,it),s("div",{class:"image-actions"},[s("button",{type:"button",onClick:w,class:"change-btn"},"æ›´æ¢"),s("button",{type:"button",onClick:U,class:"remove-btn"},"åˆ é™¤")])])):(A(),T("div",{key:0,class:"upload-placeholder",onClick:w},[...t[17]||(t[17]=[s("div",{class:"upload-icon"},"ğŸ“·",-1),s("div",{class:"upload-text"},"ç‚¹å‡»ä¸Šä¼ å¤±ç‰©ç…§ç‰‡",-1),s("div",{class:"upload-hint"},"æ”¯æŒ JPGã€PNG æ ¼å¼ï¼Œæœ€å¤§ 10MB",-1)])]))]),v.value?(A(),T("div",ut,$(v.value),1)):O("",!0)]),s("div",ct,[t[19]||(t[19]=s("label",{for:"publishTime"},"å‘å¸ƒæ—¶é—´",-1)),S(s("input",{id:"publishTime","onUpdate:modelValue":t[6]||(t[6]=a=>l.publishTime=a),type:"datetime-local",class:"form-input"},null,512),[[N,l.publishTime]])]),s("div",dt,[t[21]||(t[21]=s("label",{for:"status"},"çŠ¶æ€",-1)),S(s("select",{id:"status","onUpdate:modelValue":t[7]||(t[7]=a=>l.status=a),class:"form-select"},[...t[20]||(t[20]=[s("option",{value:"AVAILABLE"},"å¯è®¤é¢†",-1),s("option",{value:"PENDING_REVIEW"},"å®¡æ ¸ä¸­",-1),s("option",{value:"CLAIMED"},"å·²è®¤é¢†",-1),s("option",{value:"RETURNED"},"å·²å½’è¿˜",-1)])],512),[[G,l.status]])]),s("div",mt,[s("button",{type:"button",onClick:t[8]||(t[8]=a=>n.$emit("close")),class:"cancel-btn"}," å–æ¶ˆ "),s("button",{type:"submit",disabled:y.value,class:"submit-btn"},$(y.value?"ä¿å­˜ä¸­...":"ä¿å­˜ä¿®æ”¹"),9,pt)])],32)])]))}},Nt=q(vt,[["__scopeId","data-v-f3831922"]]);export{Nt as E,wt as a,It as b,bt as c,St as f,ht as t,K as u};
